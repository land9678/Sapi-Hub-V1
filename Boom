local UseSkill = true
local playersaimbot = nil
local PlayersPosition = nil
local currentTargetType = nil
local lastTarget = nil
local maxRange = 1000000

local function getHRP(model)
    if not model or not model:FindFirstChild("HumanoidRootPart") then
        return nil
    end
    return model.HumanoidRootPart
end

local function isAllyWithMe(targetplayer)
    local myGui = player:FindFirstChild("PlayerGui")
    if not myGui then
        return false
    end

    local scrolling =
        myGui:FindFirstChild("Main") and myGui.Main:FindFirstChild("Allies") and
        myGui.Main.Allies:FindFirstChild("Container") and
        myGui.Main.Allies.Container:FindFirstChild("Allies") and
        myGui.Main.Allies.Container.Allies:FindFirstChild("ScrollingFrame")

    if scrolling then
        for _, frame in pairs(scrolling:GetDescendants()) do
            if frame:IsA("ImageButton") and frame.Name == targetplayer.Name then
                return true
            end
        end
    end

    return false
end

local function isEnemy(targetplayer)
    if not targetplayer or targetplayer == player then
        return false
    end

    local myTeam = player.Team
    local targetTeam = targetplayer.Team

    if myTeam and targetTeam then
        if myTeam.Name == "Pirates" and targetTeam.Name == "Marines" then
            return true
        elseif myTeam.Name == "Marines" and targetTeam.Name == "Pirates" then
            return true
        end

        if myTeam.Name == "Pirates" and targetTeam.Name == "Pirates" then
            if isAllyWithMe(targetplayer) then
                return false -- ally, not enemy
            end
            return true
        end

        if myTeam.Name == "Marines" and targetTeam.Name == "Marines" then
            return false
        end
    end

    return true
end

local function getClosestplayer(lpHRP)
    if not lpHRP then
        return nil
    end

    local closest = nil
    local closestDist = math.huge
    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= player and isEnemy(pl) and pl.Character and pl.Character.Parent ~= nil then
            local hum = pl.Character:FindFirstChildWhichIsA("Humanoid")
            local hrp = getHRP(pl.Character)
            if hum and hum.Health > 0 and hrp then
                local dist = (hrp.Position - lpHRP.Position).Magnitude
                if dist <= maxRange and dist < closestDist then
                    closestDist = dist
                    closest = pl
                end
            end
        end
    end
    return closest
end


game:GetService("RunService").RenderStepped:Connect(function()
    local lpChar = player.Character
    if not lpChar then return end

    local lpHRP = lpChar:FindFirstChild("HumanoidRootPart")
    if not lpHRP then return end

    local targetPlayer = getClosestplayer(lpHRP)

    if targetPlayer and targetPlayer ~= player and targetPlayer.Character then
        playersaimbot = targetPlayer.Name

        local hrp = getHRP(targetPlayer.Character)
        PlayersPosition = getPredictedPosition(hrp)

        if lastTarget ~= targetPlayer then
            lastTarget = targetPlayer
            to(targetPlayer)
        end
    else
        playersaimbot = nil
        PlayersPosition = nil
        lastTarget = nil
    end
end)

function bypass(Pos)
    if tween then
        tween:Cancel()
    end
    if hide or getgenv().shop or game:GetService("Players").LocalPlayer.PlayerGui.Main.InCombat.Visible then
        return
    end

    dist = math.huge
    is = nil

    for i, v in pairs(island) do
        if (Pos.Position - v.Position).magnitude < dist then
            is = v

            dist = (Pos.Position - v.Position).magnitude
        end
    end

    if is == nil then
        return
    end
    if lp:DistanceFromCharacter(Pos.Position) > distbyp then
        if is.X == 61163.8515625 and is.Y == 11.6796875 and is.Z == 1819.7841796875 then
            game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(
                "requestEntrance",
                Vector3.new(61163.8515625, 11.6796875, 1819.7841796875)
            )
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame =
                CFrame.new(61163.8515625, 11.6796875, 1819.7841796875)
            return
        end
        if (lp.Character.Head.Position - Pos.Position).magnitude > (is.Position - Pos.Position).magnitude then
            if tween then
                tween:Destroy()
            end
            if not stopbypass then
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = is

                game:GetService("Players").LocalPlayer.Character:WaitForChild("Humanoid"):ChangeState(15)
                lp.Character:SetPrimaryPartCFrame(is)
                lp.Character.Head:Destroy()
                wait(1)
                lp.Character:SetPrimaryPartCFrame(is)
            end
        end
    end
end

function to(Pos)
    if not stopbypass then
        bypass(Pos)
    end
    if
        game.Players.LocalPlayer.Character:FindFirstChild("Humanoid") and
            game.Players.LocalPlayer.Character:FindFirstChild("Humanoid").Health > 0 and
            not areportal
     then
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame =
            CFrame.new(
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.X,
            Pos.Y,
            game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.Z
        )

        Distance = (Pos.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
        if Distance < 350 then
            lp.Character.HumanoidRootPart.CFrame = Pos
        end

        if not game.Players.LocalPlayer.Character.PrimaryPart:FindFirstChild("Hold") then
            local Hold = Instance.new("BodyVelocity", game.Players.LocalPlayer.Character.PrimaryPart)
            Hold.Name = "Hold"
            Hold.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            Hold.Velocity = Vector3.new(0, 0, 0)
        end
        local mul = 0.87
        if Distance < 250 then
            Speed = 700 * mul
        elseif Distance < 500 then
            Speed = 500 * mul
        elseif Distance < 1000 then
            Speed = 450 * mul
        elseif Distance >= 1000 then
            Speed = 350 * mul
        end
        pcall(
            function()
                tween =
                    game:GetService("TweenService"):Create(
                    game.Players.LocalPlayer.Character.HumanoidRootPart,
                    TweenInfo.new(Distance / Speed, Enum.EasingStyle.Linear),
                    {
                        CFrame = Pos
                    }
                )
            end
        )
        tween:Play()

        if _G.StopTween == true then
            tween:Cancel()
            _G.Clip = false
        end
    end
end

spawn(
    function()
        while wait() do
            if UseSkill then
                pcall(
                    function()
                        for i, v in pairs(game:GetService("Workspace").Character:GetChildren()) do
                            if
                                game:GetService("Players").LocalPlayer.Character:FindFirstChild(
                                    game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                                )
                             then
                                MasBF =
                                    game:GetService("Players").LocalPlayer.Character[
                                    game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                                ].Level.Value
                            elseif
                                game:GetService("Players").LocalPlayer.Backpack:FindFirstChild(
                                    game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                                )
                             then
                                MasBF =
                                    game:GetService("Players").LocalPlayer.Backpack[
                                    game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                                ].Level.Value
                            end
                            if game:GetService("Players").LocalPlayer.Character:FindFirstChild("Dragon-Dragon") then
                                if _G.SkillZ then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "Z", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "Z", false, game)
                                end
                                if _G.SkillX then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "X", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "X", false, game)
                                end
                                if _G.SkillC then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "C", false, game)
                                    wait(2)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "C", false, game)
                                end
                            elseif game:GetService("Players").LocalPlayer.Character:FindFirstChild("Venom-Venom") then
                                if _G.SkillZ then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "Z", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "Z", false, game)
                                end
                                if _G.SkillX then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "X", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "X", false, game)
                                end
                                if _G.SkillC then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "C", false, game)
                                    wait(2)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "C", false, game)
                                end
                            elseif
                                game:GetService("Players").LocalPlayer.Character:FindFirstChild("Human-Human: Buddha")
                             then
                                if
                                    _G.SkillZ and
                                        game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.Size ==
                                            Vector3.new(2, 2.0199999809265, 1)
                                 then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "Z", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "Z", false, game)
                                end
                                if _G.SkillX then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "X", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "X", false, game)
                                end
                                if _G.SkillC then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "C", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "C", false, game)
                                end
                                if _G.SkillV then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "V", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "V", false, game)
                                end
                            elseif
                                game:GetService("Players").LocalPlayer.Character:FindFirstChild(
                                    game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                                )
                             then
                                if _G.SkillZ then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "Z", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "Z", false, game)
                                end
                                if _G.SkillX then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "X", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "X", false, game)
                                end
                                if _G.SkillC then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "C", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "C", false, game)
                                end
                                if _G.SkillV then
                                    local args = {
                                        [1] = PlayersPosition
                                    }
                                    game:GetService("Players").LocalPlayer.Character[
                                        game:GetService("Players").LocalPlayer.Character:FindFirstChildOfClass("Tool").Name
                                    ].RemoteEvent:FireServer(unpack(args))
                                    game:GetService("VirtualInputManager"):SendKeyEvent(true, "V", false, game)
                                    game:GetService("VirtualInputManager"):SendKeyEvent(false, "V", false, game)
                                end
                            end
                        end
                    end
                )
            end
        end
    end
)

spawn(
    function()
        game:GetService("RunService").RenderStepped:Connect(
            function()
                pcall(
                    function()
                        if UseSkill then
                            for i, v in pairs(
                                game:GetService("Players").LocalPlayer.PlayerGui.Notifications:GetChildren()
                            ) do
                                if v.Name == "NotificationTemplate" then
                                    if string.find(v.Text, "Skill locked!") then
                                        v:Destroy()
                                    end
                                end
                            end
                        end
                    end
                )
            end
        )
    end
)

spawn(
    function()
        pcall(
            function()
                game:GetService("RunService").RenderStepped:Connect(
                    function()
                        if UseSkill then
                            local args = {
                                [1] = PlayersPosition
                            }
                            game:GetService("Players").LocalPlayer.Character[
                                game:GetService("Players").LocalPlayer.Data.DevilFruit.Value
                            ].RemoteEvent:FireServer(unpack(args))
                        end
                    end
                )
            end
        )
    end
)
